<html lang="en">

<head>
  <!-- <link rel="stylesheet" href="../paged-media/highlight/styles/solarized-light.css"> -->
  <link rel="stylesheet" href="../paged-media/prism/prism.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">
  <title></title>
</head>

<body data-type="book">

  <h1 id="project-idea%3A-creating-your-own-blog-platform">Project Idea: Creating your own blog platform</h1>
<p>Sooner or later everyone creates a content publishing system, right? :)</p>
<p>The idea is to put together a lot of the things I’ve learned over the past couple years and build a Node-based platform to publish content online.</p>
<p>It is also a way to learn server-side best practices and a lot of the things I read as far as performance and good web citizenship.</p>
<p>Finally, this project is an exercise on front-end development. Put your money where your mouth is and use the newer web technologies.</p>
<h2 id="content-and-structure">Content And Structure</h2>
<p>I’m looking to replace multiple pieces that used to exists and, some, still exists spread around my domain. The idea is to create a simple way to manage these pieces in one app.</p>
<p>Long form writing is the one that I’m currently finding more and more intriguing. Combined with a working front-end (discussed later) it gives me the flexibility to do pretty much anything I may want to.</p>
<p>A short list of the content areas is below:</p>
<ul>
<li>Projects</li>
<li>Space to serve static files
<ul>
<li>WebGL</li>
<li>Docs</li>
</ul>
</li>
<li>Long Form Writing
<ul>
<li>Markdown Authoring</li>
<li>Syntax Highlighting (Prism.js)</li>
</ul>
</li>
</ul>
<h2 id="backend-requirements">Backend Requirements</h2>
<p>This is where a lot of the work will happen. I know how to work with most of the CRUD functions in a <a href="http://expressjs.com/">Express</a>/<a href="https://www.mongodb.com/">MongoDB</a>/<a href="http://mongoosejs.com/">Mongoose</a>/<a href="https://handlebarsjs.com/">Handlebars</a>  stack but now I want to get the full functionality in the back-end before jumping to the front end and the decisions that need to happen there.</p>
<p>I’m also experimenting with Google Cloud as the hosting platform. Google <a href="https://cloud.google.com/appengine/docs/standard/">App. Engine Standard Environment</a> has recently included <a href="https://cloud.google.com/appengine/docs/standard/nodejs/">Node 8</a> as part of the offering. There are several outstanding questions regarding the product and whether Google offers a MongoDB equivalent database but having everything in one environment sounds interesting.</p>
<p>An incomplete list of the stack:</p>
<ul>
<li>Node
<ul>
<li>Express</li>
</ul>
</li>
<li>Database
<ul>
<li>MongoDB
<ul>
<li>Mongoose</li>
</ul>
</li>
</ul>
</li>
<li>Templating Engine
<ul>
<li>Handlebars</li>
</ul>
</li>
<li>Deployment
<ul>
<li>Google Cloud</li>
</ul>
</li>
</ul>
<h2 id="front-end-requirements">Front-End Requirements</h2>
<p>In the front-end I’m working on two primary questions:</p>
<p><strong>Do I want to use a framework or design system library?</strong> I’ve been looking at the new Material Design system and it looks promising.</p>
<p>On the other hand, creating my own design system library would make it easier to incorporate other ideas, like testing if we can use a single variable font for an entire site or application.</p>
<p>Jason Pamental has done a lot of work exploring this area; the ones I like the best are his <a href="https://codepen.io/jpamental/pen/MGEPEL">FF Meta Variable Font Demo</a> and the <a href="https://codepen.io/jpamental/pen/oqJRbo">Outdoor Adventure Variable Font/Art Direction Demo</a> Codepen demos where he uses variable fonts (and in the case of the FF Meta Variable Font Demo a single font) to build an application with all the typographical requirements.</p>
<p>This would also allow me to create a design system that works for me. Perhaps building a smaller set of elements that I can compose as I need using Handlebar’s layouts and partials system may be a better idea than adopting a system wholesale.</p>
<h2 id="building-the-site">Building the site</h2>
<p>Building the back-end will be an exercise on learning how to use Express and Handlebars. We’ll start with configuring the site.</p>
<h3 id="getting-started">Getting Started</h3>
<p>Since this is a Node application we have to create the default <code>package.json</code> file. The following command will generate the package file with default values.</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> init -y
</code></pre>
<p>The next step is to install Express globally. This will not install any packages in our project, it’ll just build it.</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i -g expess
</code></pre>
<p>Once Express is installed globally move to the parent directory of where you want to install the project and run the command below:</p>
<pre class="language-bash"><code class="language-bash">express --view hbs --css sass --git my-project
</code></pre>
<p>This command will create an Express application with the following configuration:</p>
<ul>
<li>Handlebars for the views</li>
<li>SASS (SCSS) for the CSS pre-processing</li>
<li>A default <code>.gitignore</code> file</li>
</ul>
<p>When it’s done installing follow the instructions and run the following commands:</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> my-project
<span class="token function">npm</span> i
</code></pre>
<p>This will download and add a long list of packages to <code>package.json</code> and get the project ready to actually begin writing code. To make sure that everything works, run this command:</p>
<pre class="language-bash"><code class="language-bash">node <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>publisher-demo:* ./bin/www
</code></pre>
<p>Running your application like this requires that you stop the server and restart it when you make any changes. That’s tedious and I don’t really want to do that.</p>
<p>To make things better, we’ll use <a href="https://www.npmjs.com/package/nodemon">nodemon</a> to monitor our files and automatically restart the application when we make changes. This is good for development but <strong><em>it is not good for production</em></strong>. Please keep that in mind</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i -D nodemon
</code></pre>
<p>And modify your start up command to look like this:</p>
<pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>publisher-demo:* nodemon ./bin/www
</code></pre>
<h3 id="basic-layout-and-functionality">Basic Layout and functionality</h3>
<p>The basic layout of an Express application looks like this. In the rest of this section we’ll dissect the code and see what it does and how it affects the application.</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">.</span>
├── app.js
├── bin
│   └── www
├── package.json
├── static
├── public
│   ├── images
│   ├── javascripts
│   └── stylesheets
├── routes
│   ├── index.js
│   └── users.js
└── views
    ├── error.hbs
    ├── index.hbs
    └── layout.hbs
</code></pre>
<p>uEven though it’s not the first file on the list, I’ll explain <code>bin/www</code> first. It is a Node script that will configure our server and make sure that there are no errors in the server configuration before the server runs.</p>
<p><code>app.js</code> is the server script. You may see examples that call it <code>server.js</code> or <code>index.js</code>. This is where we configure the server and its behavior.</p>
<p><code>package.json</code> holds Node and NPM related configuration and the list of packages installed for the app.</p>
<p><code>static</code> is the place for all the sta</p>
<p>The <code>public</code> directory hold static assets for the application such as images, scripts, stylesheets, fonts and anything else that we load rather than generate.</p>
<p>The files in the <code>routes</code> directory are the controllers for different areas of the application. Rather than have one monolithical router that loads everything from one central place I’ve followed the example of the app and broke the routes into their intended purpose.</p>
<p><code>views</code> holds all the Handlebar templates that will render your content on the users’ browsers.</p>
<h3 id="configuring-the-database">Configuring the database</h3>
<p>To make sure we keep our database connection from being shown to users or people who don’t need it, I created a <code>config</code> directory. In this directory I created a <code>database.js</code> file to hold all my database-related configuration.</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// For local development only</span>
  <span class="token string">'url'</span><span class="token operator">:</span> <span class="token string">'mongodb://127.0.0.1:27017/publisher'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Next we need to make sure that <a href="http://mongoosejs.com/">Mongoose</a> is installed. We can write the configuration without having it installed, but I forgot to install it and couldn’t figure out why it wasn’t working. The command is a simple NPM install command:</p>
<pre class="language-javascript"><code class="language-javascript">npm i mongoose
</code></pre>
<p>Finally we write the database connection into our main entry point, <code>app.js</code>.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token operator">/</span> Database
<span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config/database.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// DB Connection Stuff</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span>Promise <span class="token operator">=</span> global<span class="token punctuation">.</span>Promise<span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">'connection error:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Database connection to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>connection<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> was successful :)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Now, whenever we fire up the application, assuming that the database is up and running and that there is a database named publisher, we’ll get a message in the console that the connection to the database was successful.</p>
<h3 id="making-changes-to-the-index-route">Making Changes to The Index Route</h3>
<p>The Index Route is the basic route that users will hit when they access the URL for your application. In theory we could get away with using one route in this router, something like the code below:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* GET home page. */</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'Express'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre>
<p>This will render the index template when it receives a <code>get</code> request for <code>/</code> which is the root of the application.</p>
<p>I’ve added a second route for an about page. It’s almost identical to the homepage route except for the path we follow, the template we render and the name of the page we are rendering. The route now looks like this:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* GET home page. */</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'Express'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'About'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre>
<p>We can add routes for additional functionality that will work the root of the application. For everything else I’m creating separate routes.</p>
<h3 id="projects">Projects</h3>
<p>Projects the first route where we will interact with the database using Mongoose. This requires a model and the corresponding route.</p>
<p>We’ll look at the model first.</p>
<h4 id="building-the-model">Building The Model</h4>
<p>The model describes the shape of the data we want to work with in the database. It also describe constraints for each item in the model; for example, the project name is required and must be unique in the collection.</p>
<p>When the definition is complete we export the model as <code>Project</code>, an instance of <code>mongoose.Schema</code>.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>

<span class="token keyword">const</span> projectSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    unique<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  slug<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  author<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  created<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Date<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span>now<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  updated<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Date<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span>now<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  summary<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'Default Content, please change'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  photo<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    lowercase<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    trim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  codeURL<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    lowercase<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    trim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  otherURL<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    lowercase<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    trim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  writingURL<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    lowercase<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    trim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Export the Mongoose model</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Project'</span><span class="token punctuation">,</span> projectSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="the-route">The Route</h4>
<p>The route for projects is where the pedal hits the metal. It makes use of everything we’ve worked with so far to build the projects CRUD (Create, Read, Update, Delete) functionality.</p>
<p>We use <a href="https://www.npmjs.com/package/slugify">slugify</a> to create slugs from the title of the page. so we need to import it.</p>
<p>The default route will query the database for all projects and then use that JSON data to render the projects template.</p>
<p><code>/new</code> will render a form to add new projects to the database. The form uses the <code>post</code> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">HTTP verb</a> and the <code>/projects</code> URL to add a project to the database.</p>
<p>To retrieve a single project I <code>get /:slug</code>. This route will get the single project matching the slug we choose.</p>
<p>Using <code>post</code> in a route to projects will actually create the resource in the database. It will then redirect to the default route and display all the projects.</p>
<p>There are two additional routes that need to be created.</p>
<p>The <code>put /:slug</code> project will edit an individual project and update the content of the project in the database. It is aso possible to use <code>patch</code> instead of put.</p>
<p>Finally <code>delete /:slug</code> will delete the refernced project from the database.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the model</span>
<span class="token keyword">const</span> Project <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../models/project'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// To create slugs for entries</span>
<span class="token keyword">const</span> slugify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@sindresorhus/slugify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Project<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> projects</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'projects'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'current projects'</span><span class="token punctuation">,</span>
        projects<span class="token operator">:</span> projects<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/new'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'Add New Project'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:slug'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Project<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>slug<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>slug<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> project</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'project'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        project<span class="token operator">:</span> project<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Create a new instance of the Project model</span>
  <span class="token keyword">let</span> project <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Project</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  project<span class="token punctuation">.</span>name <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>slug <span class="token operator">=</span> <span class="token function">slugify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>author <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>type <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>summary <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>summary<span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>photo <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>photo<span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>codeURL <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>codeURL<span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>otherURL <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>otherURL<span class="token punctuation">;</span>
  project<span class="token punctuation">.</span>writingURL <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>writingURL<span class="token punctuation">;</span>

  project<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/projects'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/:slug'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Still working on put /:slug '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/:slug'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'still working on delete /:slug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre>
<h2 id="the-views">The views</h2>


<!-- <script src="../paged-media/highlight/highlight.pack.js"></script> -->
<script src="../paged-media/prism/prism.js"></script>
</body>
</html>