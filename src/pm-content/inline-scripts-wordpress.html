<html lang="en">

<head>
  <!-- <link rel="stylesheet" href="../paged-media/highlight/styles/solarized-light.css"> -->
  <link rel="stylesheet" href="../paged-media/prism/prism.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">
  <title></title>
</head>

<body data-type="book">

  <h1>Inline scripts in WordPress</h1>
<p>There are times when we need to add scripts to the page that will run only when there is a script already enqueued and loaded before it happens.</p>
<p>I got bit by this when trying to use FontFaceObserver. For some reason it worked fine in development but it would give a <code>FontFaceObserver is not defined</code> error  when I moved the theme to production.</p>
<p>The solution was hidden in some older documentation. As of version 4.5 there is an additional script loading function for loading inline scripts: <code>wp_add_inline_script</code>. This function allows adding inline scripts that depend on scripts</p>
<p>The only important thing to remember is that this will only work when using a script that was enqueued using <code>wp_enqueue_script</code>.</p>
<p>The final solution  looks like this:</p>
<pre><code class="language-php">&lt;?
function rivendellweb_enqueue_fontfaceobserver() {
    wp_enqueue_script( 'ffo_script',
        get_stylesheet_directory_uri() . '/js/fontfaceobserver.js',
        array(),
        '20151215',
        false );
    wp_add_inline_script( 'ffo_script', 'const recursive = new FontFaceObserver(&quot;Recursive VF&quot;);let html = document.documentElement;
            Promise.all([recursive.load()]).then(() =&gt; {sessionStorage.fontsLoaded = true;console.log(&quot;Recursive has loaded.&quot;);
            }).catch((err) =&gt; {sessionStorage.fontsLoaded = false;console.log(&quot;Recursive failed to load&quot;, err);
            });

            // Add a class based on whether the font loaded successfully
            if (sessionStorage.fontsLoaded) {html.classList.add(&quot;fonts-loaded&quot;);
            } else {html.classList.add(&quot;fonts-failed&quot;);
            }'
        );
}

add_action( 'wp_enqueue_scripts', 'rivendellweb_enqueue_fontfaceobserver' );
</code></pre>
<h2>Links and References</h2>
<ul>
<li><a href="https://make.wordpress.org/core/2016/03/08/enhanced-script-loader-in-wordpress-4-5/">Enhanced Script Loader in WordPress 4.5</a></li>
<li><a href="https://digwp.com/2019/07/better-inline-script/">Better Way to Add Inline Scripts</a></li>
<li><a href="https://developer.wordpress.org/reference/functions/wp_add_inline_script/">wp_add_inline_script developer documentation</a></li>
</ul>


<!-- <script src="../paged-media/highlight/highlight.pack.js"></script> -->
<script src="../paged-media/prism/prism.js"></script>
</body>
</html>