<html lang="en">

<head>
  <!-- <link rel="stylesheet" href="../paged-media/highlight/styles/solarized-light.css"> -->
  <link rel="stylesheet" href="../paged-media/prism/prism.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">
  <title></title>
</head>

<body data-type="book">

  <h1>HTTP Headers and Responsive Images</h1>
<p>This is an old one but it still worries me, and made me search for a possible solution in the context of web APIs without requiring a Node package manager or a Node infrastructure.</p>
<blockquote class="twitter-tweet" data-theme="light"><p lang="en" dir="ltr">I never want to make anything that even remotely resembles this. <a href="http://t.co/QsfusOtxkI">pic.twitter.com/QsfusOtxkI</a></p>&mdash; Brad Frost (@brad_frost) <a href="https://twitter.com/brad_frost/status/599676745176997889?ref_src=twsrc%5Etfw">May 16, 2015</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>No, no ones wants code like what Brad posted in 2015, but that’s the reality when using <a href="http://responsiveimages.org/">responsive images</a>, or is it?</p>
<p>If we don’t mind doing the work on the server rather than the client we can do something like the code below, taken from <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/client-hints#device_hints">Adapting to Users with Client Hints</a>, to load WebP images for browsers that support them and JPG/PNG for browsers that don’t.</p>
<pre><code class="language-php">&lt;?php
// Check Accept for an &quot;image/webp&quot; substring.
$webp = stristr($_SERVER[&quot;HTTP_ACCEPT&quot;], &quot;image/webp&quot;) !== false ? true : false;

// Set the image URL based on the browser's WebP support status.
$imageFile = $webp ? &quot;whats-up.webp&quot; : &quot;whats-up.jpg&quot;;
?&gt;

&lt;img src=&quot;&lt;?php echo($imageFile); ?&gt;&quot; alt=&quot;I'm an image!&quot;&gt;
</code></pre>
<p>We can then shrink our responsive images by removing the formats that are not necessary using server-side code, in this case PHP.</p>
<pre><code class="language-php">&lt;?php
// Check Accept for an &quot;image/webp&quot; substring.
$webp = stristr($_SERVER[&quot;HTTP_ACCEPT&quot;], &quot;image/webp&quot;) !== false ? true : false;

$name = &quot;company-photo&quot;;
$format = $webp ? &quot;webp&quot; : &quot;jpg&quot;;
?&gt;

&lt;picture&gt;
  &lt;source srcset=&quot;
    &lt;?php echo($name); ?&gt;-256w.&lt;?php echo($format); ?&gt; 256w,
    &lt;?php echo($name); ?&gt;-512w.&lt;?php echo($format);?&gt; 512w,
    &lt;?php echo($name); ?&gt;-768w.&lt;?php echo($format); ?&gt; 768w,
    &lt;?php echo($name); ?&gt;-1024w.&lt;?php echo($format); ?&gt; 1024w,
    &lt;?php echo($name); ?&gt;-1280w.&lt;?php echo($format); ?&gt; 1280w&quot;
    type=&quot;image/&lt;?php echo($format)&quot;&gt;
      src=&quot;company-photo-256w.jpg&quot;
      sizes=&quot;(min-width: 560px) 251px, 88.43vw&quot;
      alt=&quot;The Sconnie Timber Staff!&quot;&gt;
&lt;/picture&gt;
</code></pre>
<p>The code first checks if the browser supports PHP by testing if the string <code>image/webp</code> is included in the Accept header. We record the result.</p>
<p>We then create two variables. One with the name of the file and the other one with the file extension that we use based on WebP support.</p>
<p>Then for every image in the <code>srcset</code> attribute we compose it using PHP echo statements and the variables that we created. In essence, if the browser supports WebP we use it, otherwise we use JPG images.</p>
<p>This is great but it requires a server-side script and it mixes business loogic with the HTML and it definitely gets cumbersome with more than a few images.</p>
<p>Looking at the <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/client-hints#device_hints">client hints article</a> in Web Fundamentals, I thought that they may be the solution to writing something like the PHP code in the previous example. Unfortunately, <em>Client Hints have no equivalent to the Accept HTTP header that we can parse for WebP support</em>.</p>


<!-- <script src="../paged-media/highlight/highlight.pack.js"></script> -->
<script src="../paged-media/prism/prism.js"></script>
</body>
</html>