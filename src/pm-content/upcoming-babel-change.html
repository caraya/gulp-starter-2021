<html lang="en">

<head>
  <!-- <link rel="stylesheet" href="../paged-media/highlight/styles/solarized-light.css"> -->
  <link rel="stylesheet" href="../paged-media/prism/prism.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">
  <title></title>
</head>

<body data-type="book">

  <h1>upcoming change to Babel</h1>
<p>There is a suggested change to Babel that may change the way you write your configurations, builder tasks and other aspects of your Babel configuration.</p>
<p>In the blog post <a href="https://babeljs.io/blog/2017/03/01/upgrade-to-babel-7">Upgrade to Babel 7 (WIP)</a> the Bable maintainers give information on how upcoming changes will affect Babel installations.</p>
<p>The one I’m concerned about is how to use yearly plugins. The posts states that:</p>
<blockquote>
<p>Instead of any yearly preset, we suggest that you use the newly created babel-preset-env which uses the correct plugins based on your environment.</p>
</blockquote>
<p>When configuring Babel you’d normally use the following:</p>
<pre><code class="language-json">{
  &quot;presets&quot;: [&quot;es2015&quot;, &quot;es2016&quot;, &quot;es2017&quot;]
}
</code></pre>
<p>My configuration file looks like this</p>
<pre><code class="language-javascript">gulp.task('babel', () =&gt; {
  return gulp.src('src/es6/**/*.js')
    .pipe($.sourcemaps.init())
    .pipe($.babel({
      presets: ['es2015', 'es2016', 'es2017']
    }))
    .pipe($.sourcemaps.write('.'))
    .pipe(gulp.dest('src/js/'))
    .pipe($.size({
      pretty: true,
      title: 'Babel'
    }));
});
</code></pre>
<p>The idea is that both of the examples above use the presets directly and, regardless of the level for ES6, 7, or 8 in your browser, it’ll load all the presets needed for each yearly plugin.</p>
<p>Instead the new recommended way to go is use the <a href="https://babeljs.io/docs/plugins/preset-env/">babel-preset-env</a> plugin that will only load the transformations that you need for your target browsers.</p>
<p>Used in combination with <a href="http://babeljs.io/docs/plugins/preset-stage-1/">stage-1</a>, <a href="http://babeljs.io/docs/plugins/preset-stage-2/">stage-2</a> and <a href="http://babeljs.io/docs/plugins/preset-stage-3/">stage-3</a> presets we can get fuller coverage of what we want on Javascript.</p>
<p>Leaving the targets attribute blank makes <code>preset-env</code> equivalent to <code>preset-latest</code> in terms of functionality.</p>
<p>If we want to use <code>preset-env</code> and all the stages plugins we can do something like this in the <code>babelrc.json</code> configuration.</p>
<pre><code class="language-json">{
  &quot;presets&quot;: [&quot;env&quot;,&quot;stage-1&quot;,&quot;stage-2&quot;,&quot;stage-3&quot;]
}
</code></pre>
<p>If we want to specify what versions of browsers we want to support then we can specify the <code>targets</code> parameter and provide a list in the same way we do for Autoprefixer.  The folloiwng example uses the last two versions of browsers and Safrai 7+</p>
<pre><code class="language-json">{
  &quot;presets&quot;: [
    [&quot;env&quot;, {
      &quot;targets&quot;: {
        &quot;browsers&quot;: [
          &quot;last 2 versions&quot;, 
          &quot;safari &gt;= 7&quot;
        ]
      }
    }, 
    &quot;stage-1&quot;,
    &quot;stage-2&quot;,
    &quot;stage-3&quot;
    ]
  ]
}
</code></pre>
<p>an equivalent Gulp task would look like this</p>
<pre><code class="language-javascript">gulp.task('babel', () =&gt; {
  return gulp.src('src/es6/**/*.js')
    .pipe($.sourcemaps.init())
    .pipe($.babel({
       presets: [
         [&quot;env&quot;, {
           &quot;targets&quot;: {
             &quot;browsers&quot;: [
               &quot;last 2 versions&quot;, 
               &quot;safari &gt;= 7&quot;
              ]
            }
        }, 
        &quot;stage-1&quot;,
        &quot;stage-2&quot;,
        &quot;stage-3&quot;
        ]
      ]
    }))
    .pipe($.sourcemaps.write('.'))
    .pipe(gulp.dest('src/js/'))
    .pipe($.size({
      pretty: true,
      title: 'Babel'
    }));
});
</code></pre>


<!-- <script src="../paged-media/highlight/highlight.pack.js"></script> -->
<script src="../paged-media/prism/prism.js"></script>
</body>
</html>