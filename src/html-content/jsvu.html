<h1 id="testing-javascript-in-the-browser-without-the-browser">Testing javascript in the browser without the browser</h1>
<p>There are times that we want to test snippets of Javascript code in different browsers to make sure that it works as intended in all our target browsers. I've always fired the browsers and pasted the code into DevTools or Web Inspector to check if the results are the same.</p>
<p>Now there is a pair of applications that will automate this for you: <a href="https://www.npmjs.com/package/jsvu">jsvu</a> and <a href="https://www.npmjs.com/package/eshost">eshost</a>.</p>
<p>In order to install these packages run the following command</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i -g jsvu eshost
</code></pre>
<p>JSVU (JavaScript Version Updater) manages the installation and update for differnt Javascript engines avoiding the compilation process. Out of the box, it supports the following engines and OS combinations.</p>
<p>&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Vendor&lt;/th&gt;
&lt;th&gt;JavaScript engine&lt;/th&gt;
&lt;th&gt;Binary name&lt;/th&gt;
&lt;th&gt;&lt;code&gt;mac64&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;win32&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;win64&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;linux32&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;linux64&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Microsoft&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://github.com/Microsoft/ChakraCore/issues/2278#issuecomment-277301120&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;Chakra&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;chakra&lt;/code&gt; or &lt;code&gt;ch&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;❌&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Facebook&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://github.com/facebook/hermes/issues/17&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;Hermes&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;hermes&lt;/code&gt; &amp; &lt;code&gt;hermes-repl&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;❌&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;❌&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebKit/Apple&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.apple.com/documentation/javascriptcore&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;JavaScriptCore&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;javascriptcore&lt;/code&gt; or &lt;code&gt;jsc&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅ &lt;sup&gt;<em>&lt;/sup&gt;&lt;/td&gt;
&lt;td&gt;✅ &lt;sup&gt;</em>&lt;/sup&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Fabrice Bellard&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://bellard.org/quickjs/&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;QuickJS&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;quickjs&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;❌&lt;/td&gt;
&lt;td&gt;❌&lt;/td&gt;
&lt;td&gt;❌&lt;/td&gt;
&lt;td&gt;❌&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mozilla&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;SpiderMonkey&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;spidermonkey&lt;/code&gt; or &lt;code&gt;sm&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Google&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://v8.dev&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;V8&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;v8&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Google&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://v8.dev&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;V8 debug&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;v8-debug&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Moddable-OpenSource&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://github.com/Moddable-OpenSource/moddable-xst&quot; rel=&quot;nofollow&quot;&gt;&lt;strong&gt;XS&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;xs&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✅ &lt;sup&gt;(32)&lt;/sup&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅ &lt;sup&gt;(32)&lt;/sup&gt;&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;td&gt;✅&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</p>
<p>When you first run it it will prompt you to select the JS engines to install. After initial install running the <code>jsvu</code> commannd will update the engines as appropriate.</p>
<p>Once we have the engines that we want to work with we can configure <code>ESHost</code> to run the same command with these multiple js engines. In this example we're adding the major browser's JS engines to work with ESHost.</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Chakra is old Edge's JS engine</span>
eshost --add <span class="token string">'Chakra'</span> ch ~/.jsvu/chakra
<span class="token comment"># JSCore is Safari's JS engine</span>
eshost --add <span class="token string">'JavaScriptCore'</span> jsc ~/.jsvu/javascriptcore
<span class="token comment"># Spider Monkey is Firefox JS engine</span>
eshost --add <span class="token string">'SpiderMonkey'</span> jsshell ~/.jsvu/spidermonkey
<span class="token comment"># V8 is Chrome's JS engine</span>
eshost --add <span class="token string">'V8'</span> d8 ~/.jsvu/v8
</code></pre>
<p>Once we have the engines set up, ESHost is ready to go.</p>
<p>We have multiple ways to run scripts in ESHost. We can run a short script in all configured browsers with the <code>-e</code> flag like this:</p>
<pre class="language-bash"><code class="language-bash">eshost -e <span class="token string">"12*12"</span>
</code></pre>
<p>You can also run complete scripts in the configured browsers with the following command:</p>
<pre class="language-bash"><code class="language-bash">eshost my-script.js
</code></pre>
<p>The only flags I will refer to are <code>-m</code> and <code>-s</code>.</p>
<p>The <code>-m</code> flag will treat the script as a module with the corresponding differences in syntax.</p>
<p>The <code>-s</code> flag will consolidate results when different engines produce the same result. For example, the following command:</p>
<pre class="language-bash"><code class="language-bash">eshost -se <span class="token string">"console.log(112*12)"</span>
</code></pre>
<p>will produce the following result where only JavaScriptCore produces a different result. This will help in researching browser differences that need workarounds</p>
<pre class="language-bash"><code class="language-bash">eshost -se <span class="token string">"console.log(122*12)"</span>
<span class="token comment">#### Chakra, SpiderMonkey, V8</span>
<span class="token number">1464</span>
undefined

<span class="token comment">#### JavaScriptCore</span>

TypeError: undefined is not an object <span class="token punctuation">(</span>evaluating <span class="token string">'console.log'</span><span class="token punctuation">)</span>
</code></pre>
<p>For more information use the following command:</p>
<pre class="language-bash"><code class="language-bash">eshost --help
</code></pre>
