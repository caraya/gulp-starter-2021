<h1 id="performance-tweaks-in-wordpress">Performance Tweaks in WordPress</h1>
<p>Web Performance is very important but at times it can be very frustrating.</p>
<p>WordPress introduces additional complexities to the performance analysis and troubleshooting. Performance issues in a WordPress generated page can come from many sources:</p>
<ol>
<li>HTML built into PHP templates</li>
<li>HTML generated by a plugin's PHP code</li>
<li>Scripts loaded by the current theme</li>
<li>Scripts loaded by plugins</li>
<li>The way the WordPress accomplishes a task</li>
</ol>
<p>Knowing these differences we'll look at ways to improve the site's performance, how they work with WordPress and address questions that may or may not be performance related.</p>
<p>Some of these solutions require PHP code to implement and some of them will require additional plugins.</p>
<h2 id="number-of-scripts-and-their-location">Number of scripts and their location</h2>
<p>All plugins that deal with front end code will add one or more scripts and stylesheets. The new stylesheets may cause layout shifts as the new styles override existing content layout and styles or insert elements into an already loaded DOM.</p>
<p>Unless they are coded to put the script in the footer, plugins will place theirs in the header and this will block rendering until all the scripts have been downloaded, parsed and executed.</p>
<p>Deactivating and removing plugins will reduce the number of assets the browser needs to proceess and download but it may also remove functionality.</p>
<p>There are also ways to selectively move plugins scripts to the footer, either when enqueueing the scripts with PHP or later via plugins like <a href="https://wordpress.org/plugins/scripts-to-footerphp/">scripts to footer</a>. Both of these options allow you to keep scripts in the header for those scripts that will error out when place at the end of the page (Automattic's AMP plugin comes to mind).</p>
<h2 id="remove-gutenberg-block-styles">Remove Gutenberg Block Styles</h2>
<p>Even if you're not running Gutenberg blocks, WordPress will still link to block-related stylesheets.</p>
<p>To remove them we need dequeue the block stylesheets. It is a two step process.</p>
<ol>
<li>Define the function that will perform the actual work, in this case, use <a href="https://developer.wordpress.org/reference/functions/wp_dequeue_style/">wp_dequeue_style</a> to remove the stylesheets</li>
<li>Create an action that tells WordPress what action to use (<a href="https://developer.wordpress.org/reference/hooks/wp_enqueue_scripts/">wp_enqueue_scripts</a>) and what function to use as a callback</li>
</ol>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">rivendellweb_remove_wp_block_library_css</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">wp_dequeue_style</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp-block-library'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">wp_dequeue_style</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp-block-library-theme'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp_enqueue_scripts'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rivendellweb_remove_wp_block_library_css'</span><span class="token punctuation">,</span> <span class="token number">9999</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h2 id="remove-admin-toolbar-styles">Remove Admin Toolbar Styles</h2>
<p>For some reason WordPress loads admin toolbar related stylesheets even when I'm not using the toolbar so I had to create another function to remove them.</p>
<p>The function, <code>rivendellweb_hide_admin_bar_from_front_end</code> does the following:</p>
<ol>
<li>It checks if we've requested an admin screen. If we are in an admin screen then we return because we want the admin styles for the admin pages</li>
<li>If we're not in an admin interface we remove the <a href="https://developer.wordpress.org/reference/functions/_admin_bar_bump_cb/">_admin_bar_bump()</a> stylesheet.</li>
</ol>
<p>We add a filter for <a href="https://developer.wordpress.org/reference/functions/show_admin_bar/">show_admin_bar</a> and use the <code>rivendellweb_hide_admin_bar_from_front_end</code> function we just defined as the callback.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">rivendellweb_hide_admin_bar_from_front_end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">is_blog_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">remove_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp_head'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'_admin_bar_bump_cb'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">add_filter</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'show_admin_bar'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rivendellweb_hide_admin_bar_from_front_end'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h2 id="full-content-or-excerpts%3F">Full content or excerpts?</h2>
<p>When you have large pieces of text you may get a warning from Lighthouse about your DOM being too long.</p>
<p>The theme I create has the option to change between full text or excerpts in the homepage in the customizer. It comes, again, to user experience versus performance. When is it OK to sacrifice one for ther other?</p>
<h2 id="to-pwa-or-not-to-pwa%3F">To PWA or not to PWA?</h2>
<p>When researching how to improve performance I found a surprising number of PWA plugins available for WordPress.</p>
<p>Even if you don't want to turn your blog into a PWA, just the service worker portion of a PWA should improve performance. Caching elements on the client should definitely improve performance on second and subsequent loads.</p>
<h2 id="my-biggest-concern">My biggest concern</h2>
<p>While the <code>functions.php</code> file runs multiple useful functions that enhnace performance and adds functionality, I am concerned that it's becoming too large to run efficiently and that it might become a bottleneck.</p>
