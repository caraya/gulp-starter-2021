<h1 id="wordpress-cms-crud">WordPress CMS CRUD</h1>
<p>The whole idea of the WordPress REST API is to allow developers to use whateveer tools they choose to create front-ends for WordPress systems.  We're no longer limited to PHP and the Gutenberg editor and the possibilities are endless.</p>
<p>This post will cover authentication using JWT, listing pages of posts, viewing individual posts and the basic CRUD operations: create, update and delete. We covered setting up JWT authentication in WordPress in <a href="https://publishing-project.rivendellweb.net/adding-jwt-to-wordpress/">Adding JWT to WordPress</a></p>
<p>We will write this using ES Modules, so we'll have to build a quick WebPack build system to convert it into something that works in browsers.</p>
<h2 id="the-build-system">The build system</h2>
<p>Because we will be working with modules we need to write a quick WebPack build scrypt that will use Babel to convert this into something that browsers will read without having to inline scripts with <code>type=module</code>.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  config <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src/index.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">"bundle.min.js"</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
      port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      https<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      contentBase<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
      rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">"babel-loader"</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-modules"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
      minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">"development"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>devtool <span class="token operator">=</span> <span class="token string">"source-map"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>We then install the Node modules that we'll need for WebPack to run.</p>
<p>The only module I'll mention is <a href="https://github.com/babel/preset-modules/blob/master/README.md">@babel/preset-modules</a>. It is an improvement over preset-env in that it fixes additional problems that would cause bundled code to be larger than necessary.</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i -D @babel/cli <span class="token punctuation">\</span>
@babel/core <span class="token punctuation">\</span>
@babel/preset-modules <span class="token punctuation">\</span>
babel-loader <span class="token punctuation">\</span>
terser-webpack-plugin <span class="token punctuation">\</span>
webpack webpack-cli <span class="token punctuation">\</span>
webpack-dev-server
</code></pre>
<p>We will also install the packages that we'll use directly in the code we write.</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i axios <span class="token punctuation">\</span>
form-urlencoded <span class="token punctuation">\</span>
js-cookie
</code></pre>
<p><a href="https://www.npmjs.com/package/axios">axios</a> is the package that we'll use to handle fetching data from the server.</p>
<p><a href="https://www.npmjs.com/package/form-urlencoded">form-urlencoded</a> will serialize the data we send to the server</p>
<p><a href="https://github.com/js-cookie/js-cookie#readme">js-cookie</a> provides a programmatic way to set and read cookies. We'll store the JSON Web Token in a cookie that we'll read in different parts of the code.</p>
<h2 id="create-initial-state">Create Initial State</h2>
<p>We will create a sate constant where we'll set initial values for our authentication, and data storage for the values we get from the API.</p>
<p>We also create a function to add elements to the state. This is a very simplified version of what a state management library would do and, if we use React or Vue it would be unnecessary.</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Set state object with values that are changed programatically</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  loggedIn<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  restUrl<span class="token operator">:</span> <span class="token string">"http://localhost:8888/wordpress/wp-json/"</span><span class="token punctuation">,</span>
  token<span class="token operator">:</span> <span class="token string">"wp-token"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">toSet<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  state<span class="token punctuation">[</span>toSet<span class="token punctuation">]</span> <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="authenticate">Authenticate</h2>
<p>To authenticate we first import all the packages that we'll use: Axios, js-cookie and form-urlencoded. We also import our state script.</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Import libraries</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">"js-cookie"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> formurlencoded <span class="token keyword">from</span> <span class="token string">"form-urlencoded"</span><span class="token punctuation">;</span>

<span class="token comment">// Import configs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../state"</span><span class="token punctuation">;</span>
</code></pre>
<p>We then check if the cookie with our JWT token exists, meaning that the user is authenticated.</p>
<p>If it does then we initiate the login process and display the log out button.</p>
<p>It we're not logged in then we display the login form and initiate the logout process.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The code make the following assumptions:</p>
<ul>
<li>We have a login form where the user will enter his username and password</li>
<li>On successful login the form will be replaced with a logout button</li>
</ul>
<p>The code proceeds as follows:</p>
<ol>
<li>Capture the username and password values from the form</li>
<li>Use Axios to make a POST request to the JWT token endpoint with the url-encoded credentials as the payload data</li>
<li>If we get back a 200 response code, and only then, we set a cookie with the token as the value</li>
<li>We call the <code>init()</code> function</li>
<li>If we do not receive a 200 code there was a problem and we tell the user that we couldn't log her in</li>
<li>If there was an error with the promise, the <code>catch()</code> block is called and we tell the user what the error was</li>
</ol>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getEl</span><span class="token punctuation">(</span>loginForm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"submit"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> creds <span class="token operator">=</span> <span class="token punctuation">{</span>
      username<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      password<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

    <span class="token comment">// Make request to authenticate</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> state<span class="token punctuation">.</span>restUrl <span class="token operator">+</span> <span class="token string">"jwt-auth/v1/token"</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token function">formurlencoded</span><span class="token punctuation">(</span>creds<span class="token punctuation">)</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"application/x-www-form-urlencoded"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">200</span> <span class="token operator">===</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>token<span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            expires<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            secure<span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
          <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// Executed when response code is not 200</span>
          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Login failed, please check credentials and try again!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// Also log the actual error</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>login()</code> function does housekeeping. It removes the login form, it shows the listing of posts and does any other task that you need to do once the user is logged in.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Set the loggedIn status to true</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"loggedIn"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Remove login form and replace it</span>
  <span class="token comment">// with log out button</span>

  <span class="token comment">// Show the listing of posts</span>

  <span class="token comment">// Do whatever else you need to</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>initLogout()</code> function handles the logout functionality.</p>
<p>It is conceptually simpler than <code>initLogin()</code>. It removes the token cookie and it calls the <code>logout()</code> function.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup event listeners for logout form</span>
  <span class="token function">getEl</span><span class="token punctuation">(</span>logoutForm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>token<span class="token punctuation">,</span> <span class="token punctuation">{</span> secure<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>logout()</code> function, like its login counterpart, does the housekeeping we need to do to make sure this works.</p>
<p>We set the loggedIn state to false so that the workflow will prompt for a login.</p>
<p>We swap the logout button for the login form and we show the posts available when the user is not logged in.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Set the loggedIn statis to false</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"loggedIn"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Remove logout button and adds login form</span>

  <span class="token comment">// Show unauthenticated posts listing</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="read-content">Read Content</h2>
<p>To display the content of our WordPress blog we need to do two things: display a list of all posts, like what you'd see in a default WordPress home page and display individual posts.</p>
<p>We'll tackle these tasks separately.</p>
<h3 id="post-listing">Post Listing</h3>
<p>To get a listing of the first posts on the database, 10 by default, we run code similar to the init function below.</p>
<p>We use Axios to make a GET request to the <code>posts</code> API endpoint. We save the posts data to our state object and call the render function.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// If coming from an event,</span>
  <span class="token comment">// prevent default behavior</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Make API request with Axios</span>
  axios
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>restUrl <span class="token operator">+</span> <span class="token string">"wp/v2/posts"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      params<span class="token operator">:</span> <span class="token punctuation">{</span>
        per_page<span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data<span class="token operator">:</span> posts <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"posts"</span><span class="token punctuation">,</span> posts<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>render()</code> function is what creates the content that will create the contetn we display to the users.  It is cumbersome and, for a production applications, I would definitely consider using Handlebars or somekid of templating solution but in this case I'm more concernned with the authentication and how it works.</p>
<p>For each post that we get from the database via ou state object we do the following:</p>
<ol>
<li>We create and article element</li>
<li>We add the <code>post</code> class to the article we just created</li>
<li>We then create the content using the article's <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML">innerHTML</a> attribute with a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template Literal</a>
<ul>
<li>The template literal interpolates values from the posts we store in our state object</li>
</ul>
</li>
<li>We add an event listener to the post title to link to the post and then call the <code>post()</code> function</li>
</ol>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Map through the posts</span>
  state<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">post</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Setup the post article element</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token function">createEl</span><span class="token punctuation">(</span><span class="token string">"article"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
    article<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
    article<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;h2 class="entry-title">
        &lt;a href="#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post<span class="token punctuation">.</span>slug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">
          </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post<span class="token punctuation">.</span>title<span class="token punctuation">.</span>rendered<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        &lt;/a>
      &lt;/h2>
      &lt;div class="entry-content">
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post<span class="token punctuation">.</span>excerpt<span class="token punctuation">.</span>rendered<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/div>
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

  article<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".entry-title a"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">,</span> post<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre>
<h3 id="single-post">Single Post</h3>
<p>The single post render function does as the title says, it renders the content of a single post on screen and, if the user is logged in, displays links to edit and delete the current post.</p>
<p>The functions does the following:</p>
<ol>
<li>Create the article and a</li>
<li>Attach the post class to it.</li>
<li>Add the content using innerHTML.
<ul>
<li>The content includes a link to go back to the post listing; we'll attach an event to the link later</li>
<li>We also use the rendered versions of the title and the content for the post</li>
</ul>
</li>
<li>We attach a click event to the back link so that clicking on the link will display a list of the available posts</li>
<li>If the user is logged in, provide links to edit and delete the post</li>
</ol>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup the post article element</span>
  <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token function">createEl</span><span class="token punctuation">(</span><span class="token string">"article"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  article<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
  article<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;p>&lt;a id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>backBtn<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" href="#">
    &amp;lt; Back to Posts&lt;/a>&lt;/p>
    &lt;h1 class="entry-title">
      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>post<span class="token punctuation">.</span>title<span class="token punctuation">.</span>rendered<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    &lt;/h1>
    &lt;div class="entry-content">
      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>post<span class="token punctuation">.</span>content<span class="token punctuation">.</span>rendered<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    &lt;/div>
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

  <span class="token comment">// Attach event listeners to back button</span>
  article<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>backBtn<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token comment">// 4</span>

  <span class="token comment">// If logged in, display edit link</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>loggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    article<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">editLink</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>post<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    article<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">deleteLink</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>post<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token comment">// 5</span>

  <span class="token comment">// Clear the posts from the page</span>

  <span class="token comment">// Add the single post to the page</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The last two functions of this section, <code>editLink()</code> and <code>deleteLink()</code> woork similarly so we'll describe them together.</p>
<p>They will create a link element and add the respective class (edit and delete) and content text.</p>
<p>They will add a click event handler that will call the appropriate function, <code>loadPost()</code> for <code>editLink()</code> and <code>deletePost()</code> for <code>deleteLink()</code>.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">editLink</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup the edit link</span>
  <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  link<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"#edit-post"</span><span class="token punctuation">;</span>
  link<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"edit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  link<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"Edit"</span><span class="token punctuation">;</span>

  link<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"editorPost"</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">loadPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Return the link element</span>
  <span class="token keyword">return</span> link<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">deleteLink</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup the delete link</span>
  <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  link<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"#delete-post"</span><span class="token punctuation">;</span>
  link<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"delete-post"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  link<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"Delete"</span><span class="token punctuation">;</span>

  link<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">deletePost</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Return the delete link</span>
  <span class="token keyword">return</span> link<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>With the code so far we have the basic authenticaation structure and a way listing of posts and individual posts.</p>
<p>We'll explore more details in the next post.</p>
<h1 id="wordpress-cms-crud-(part-3)%3A-some-additional-thoughts-and-ideas">WordPress CMS CRUD (Part 3): Some additional thoughts and ideas</h1>
<p>In the last posts we created a CRUD system for authenticated WordPress requests but it's not complete. It currently only deals with the post content, it doesn't provide an easy way to paginate content, and it doesn't provide for how to access other parts of a WordPress site or app.</p>
<p>This post will discuss solutions to these problems.</p>
<h2 id="embedding-content-related-to-the-post">Embedding content related to the post</h2>
<p>When we load the data from the <code>posts</code> REST endpoint we get references to the post assets like featured image, author, and comments.</p>
<p>This is good when we're exploring the API but it becomes troublesome when we are building the content out for displaying it to the user. We would have to make additional requests for these assets and we're not guaranteed that they exist so these additional requests and delays may be for nothing.</p>
<p>Instead we can leverage the API and use the <code>_embed</code> query parameter to include the additional post resources when we fetch the posts. This makes the response larger but it guarantees that we will have all the data available to build post listings and individual posts.</p>
<p>TO make the embedded assets available to individual posts, we need to modify the <code>init()</code> function to add the <code>_embed: &quot;&quot;</code> parameter to the <code>get</code> Axios call</p>
<p>The modified code looks like this</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>restUrl <span class="token operator">+</span> <span class="token string">"wp/v2/posts/"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      _embed<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token comment">// Set number of posts to get</span>
      per_page<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This code will embed all associates assets to each individual post on the response, making it easier to create posts the match what we get with a WordPress theme.</p>
<h2 id="paginating-content-for-navigation">Paginating content for navigation</h2>
<p>By default, the WordPress REST API will return ten items per request.  We can change that using the <code>per_page</code> parameter to change the number of items that the API returns up to one hundred.</p>
<h3 id="creating-the-pages">Creating the pages</h3>
<p>But in and of itself this is not enough. Using <code>per_page</code> will always returns the same data. We need to tell WordPress what page of content we want.</p>
<p>The way to do it is to combine <code>per_page</code>, that will give us the number of items that we want the API to return, and <code>page</code> that provides the offset where to start the count of items to return.</p>
<p>For example the following request will return the second page of 5 items from the site's REST API.</p>
<pre class="language-html"><code class="language-html">/wp-json/wp/v2/posts/?per_page=5&amp;page=2
</code></pre>
<p>Both parameters are optional.</p>
<h3 id="leveraging-x-wp-totalpages">Leveraging X-WP-TotalPages</h3>
<p>So we know how to create pages of content but how do we make sure that we don't go over the last page?</p>
<p>WordPress's REST API provides two custom headers: <code>X-WP-Total</code> that gives you the total number of the type's items (post, pages,etc) in the collection and <code>X-WP-TotalPages</code> that gives the total number of pages available given the number of items per page we specify.</p>
<p>Using <code>X-WP-TotalPages</code> we can build page navigation links and we can build links to each individual page.</p>
<h2 id="accessing-other-elements-of-a-wordpress-site">Accessing other elements of a WordPress site</h2>
<p>So far we've only worked with posts and their embedded content but there are many other items that make up a WordPress application.</p>
<p>The following table, taken from <a href="https://developer.wordpress.org/rest-api/reference/">REST API Handbook Reference</a> shows you the default routes available throught he API.</p>
<p>&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th&gt;Resource&lt;/th&gt;
&lt;th&gt;Base Route&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/posts/&quot;&gt;Posts&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/posts&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/post-revisions/&quot;&gt;Post Revisions&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/posts/&lt;id&gt;/revisions&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/categories/&quot;&gt;Categories&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/categories&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/tags/&quot;&gt;Tags&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/tags&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/pages/&quot;&gt;Pages&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/pages&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/page-revisions/&quot;&gt;Page Revisions&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/pages/&lt;id&gt;/revisions&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/comments/&quot;&gt;Comments&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/comments&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/taxonomies/&quot;&gt;Taxonomies&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/taxonomies&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/media/&quot;&gt;Media&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/media&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/users/&quot;&gt;Users&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/users&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/post-types/&quot;&gt;Post Types&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/types&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/post-statuses/&quot;&gt;Post Statuses&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/statuses&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/settings/&quot;&gt;Settings&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/settings&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/themes/&quot;&gt;Themes&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/themes&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://developer.wordpress.org/rest-api/reference/search-results/&quot;&gt;Search&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/wp/v2/search&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;summary&gt;Default endpoints available on the WordPress REST API&lt;/summary&gt;
&lt;/table&gt;</p>
<p>This table does not include API routes added by plugins or generated outside the core API. Your overall API route table will certainly look different.</p>
<h1 id="creating-custom-post-types-and-adding-them-to-the-rest-api">Creating custom post types and adding them to the REST API</h1>
<p>One of the things I've always liked about WordPress is its flexibility. We can extend WordPress and create pretty much any type of content that we need for specific projects.</p>
<p>We can choose whether to build it inside a theme or a plugin. For the most part I would recommend building it in a plugin so that we will retain the capability even if we switch themes.</p>
<p>Like all plugins we first declare a preamble that looks like this. This is the block that makes it a plugin that we can load and use.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
   <span class="token comment">/*
   Plugin Name: Awesomeness Creator
   Plugin URI: https://example.com
   description: a plugin to create awesomeness and spread joy
   Version: 1.0
   Author: Mr. Awesome
   Author URI: https://site.com
   License: GPL2
   */</span>
<span class="token delimiter important">?></span></span>
</code></pre>
<p>The actual meat of the plugin is the custom post type registration. As with all WordPress related code, it has two parts: a callbackk function and an hook that tells WordPress what to do with the callback.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">rivendellweb_custom_book_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$args</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
      <span class="token string single-quoted-string">'public'</span>       <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'show_in_rest'</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'rest_base'</span>    <span class="token operator">=></span> <span class="token string single-quoted-string">'books'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'label'</span>        <span class="token operator">=></span> <span class="token string single-quoted-string">'Books'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">register_post_type</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'book'</span><span class="token punctuation">,</span> <span class="token variable">$args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'init'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rivendellweb_custom_book_type'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>
</code></pre>
<p>There are two arguments that are important when working with REST API routes.</p>
<p><code>show_in_rest</code> tells WordPress that we want this custom post type to show in the REST API. When I activate the plugin it adds 4 additonal books-related routes to the list of APIs available</p>
<p><code>rest_base</code> allows us to rewrite the name of the route in the REST API. The default is the same name as the custom type but there may be cases where we want a different name. In our example I chose books instead of book (singular) for the name of the route.</p>
<p>We can also create one of more taxonomies for our custom post types and, with the <code>show_in_rest</code> attribute, we can use it from the REST API.</p>
<p>Because we've used a custom name in the route with <code>base_rest</code> we have to rewrite the taxonomy to match using the <code>rewrite</code>  attribute in the custom taxonomy arguments.</p>
<p>The custom taxonomy declaration looks like this</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">rivendellweb_custom_book_genre_taxonomy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$labels</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string single-quoted-string">'name'</span>          <span class="token operator">=></span> <span class="token function">__x</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Genres'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'singular_name'</span> <span class="token operator">=></span> <span class="token function">__x</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Genre'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'taxonomy singular name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'search_items'</span>  <span class="token operator">=></span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Search Genres'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'edit_item'</span>     <span class="token operator">=></span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Edit Genre'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'add_new_item'</span>  <span class="token operator">=></span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Add New Genre'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token variable">$args</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string single-quoted-string">'labels'</span>       <span class="token operator">=></span> <span class="token variable">$labels</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'show_in_rest'</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'hierarchical'</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'query_var'</span>    <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'rewrite'</span>      <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span>
      <span class="token string single-quoted-string">'slug'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'books/genre'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'with_front'</span> <span class="token operator">=></span> <span class="token constant boolean">false</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">register_taxonomy</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'genre'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'book'</span><span class="token punctuation">,</span> <span class="token variable">$args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'init'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'rivendellweb_custom_book_genre_taxonomy'</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>With this functionality plugin installed we've created a new custom post type, added an interface to it on the admin UI and made sure we can access it through the REST API.</p>
<h1 id="creating-templates-for-custom-post-types">Creating Templates for Custom Post Types</h1>
<h1 id="adding-attributes-to-a-rest-api-endpoint">Adding attributes to a REST API endpoint</h1>
<p>When working with APIs we should never, under any circumstance, remove elements from the endpoint. Even if you're the owner there is no real way to know who's consumming your data and how they are doing it so removing elements of the API can cause unexpected and unpleasant problems down the road.</p>
<p>However, there is no problem on adding attributes to your custom endpoints. This post will discuss how to do it using built-in WordPress functions and coding practices.</p>
<p>Before we jump into adding attributes we need to ask ourselves if we really need a new attribute or if we can use combination of  existing attributes to accomplish our tasks.</p>
<p>For example we can get the 3 latest posts by using <code>per_page</code> and a value of 3 rather than having to create a custom field for our application.</p>
<p>If we decide that we need a custom field in the REST API, then the process is a two step one.</p>
<p>We first create the REST API field using the <a href="https://developer.wordpress.org/reference/functions/register_rest_field/">regiser_rest_field</a> function.</p>
<p>The first parameter is the type of post that you're adding the attribute for.</p>
<p>The second parameter is the name of the attribute that we're adding.</p>
<p>The third parameter is an array of callbacks for the field. The callbacks are:</p>
<p>&lt;dl&gt;
&lt;dt&gt;'get_callback' &lt;em&gt;Optional&lt;/em&gt;.
&lt;dd&gt;The callback function used to retrieve the field value. Default is 'null', the field will not be returned in the response.
&lt;dt&gt;'update_callback' &lt;em&gt;Optional&lt;/em&gt;.
&lt;dd&gt;The callback function used to set and update the field value. Default is 'null', the value cannot be set or updated.
&lt;dt&gt;'schema' &lt;em&gt;Optional&lt;/em&gt;.
&lt;dd&gt;The callback function used to create the schema for this field.
&lt;/dl&gt;</p>
<p>In this particular case we only need to retrieve the value of the field so we only define a <code>get_callback</code>.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">rivendellweb_add_new_field</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">register_rest_field</span><span class="token punctuation">(</span>
    <span class="token string single-quoted-string">'post'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'catlinks'</span><span class="token punctuation">,</span>
      <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'get_callback'</span>    <span class="token operator">=></span> <span class="token string single-quoted-string">'rivendellweb_get_category_links'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'update_callback'</span> <span class="token operator">=></span> <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'schema'</span>          <span class="token operator">=></span> <span class="token constant">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'rest_api_init'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rivendellweb_add_new_field'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>We then define the functions for each of the callbacks that we want to implement. In this case we only want to retrieve the value for this field, so we only need to define the <code>get_callback</code> function.</p>
<p>This function retrieves the categories from the current post, formats the categories and returns the results the categories to use as the value for the REST field.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">riivendellweb_get_category_links</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$categories</span> <span class="token operator">=</span> <span class="token function">get_the_category</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$separator</span> <span class="token operator">=</span> <span class="token string single-quoted-string">', '</span><span class="token punctuation">;</span>
  <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$categories</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span> <span class="token variable">$categories</span> <span class="token keyword">as</span> <span class="token variable">$category</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token variable">$output</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;a href="'</span> <span class="token operator">.</span> <span class="token function">esc_url</span><span class="token punctuation">(</span> <span class="token function">get_category_link</span><span class="token punctuation">(</span> <span class="token variable">$category</span><span class="token operator">-></span><span class="token property">term_id</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'">'</span> <span class="token operator">.</span> <span class="token function">esc_html</span><span class="token punctuation">(</span> <span class="token variable">$category</span><span class="token operator">-></span><span class="token property">name</span> <span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;a>'</span> <span class="token operator">.</span> <span class="token variable">$separator</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span> <span class="token variable">$output</span><span class="token punctuation">,</span> <span class="token variable">$separator</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?></span></span>
</code></pre>
