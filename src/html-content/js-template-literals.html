<h1 id="js-template-literals">JS Template Literals</h1>
<p>If you've worked with Javascript for a while you've probably hit the nightmare of string concatenation and how error prone the process is and how hard it is to troubleshoot if you're not careful.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> sentence <span class="token operator">=</span> <span class="token string">'This is a very long sentence that we want to '</span>
 <span class="token operator">+</span> <span class="token string">'concatenate together.'</span>
</code></pre>
<p>In ES6/ES2015 there is a new way to create interpolated strings: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template String Literals</a>.</p>
<p>In this post we'll discuss three areas:</p>
<ul>
<li>How to build template string literals and multi line string literals</li>
<li>Variable interpolation</li>
<li>Possible ways to use template string literals for localization</li>
</ul>
<p>None of these things are new. You've always been able to do in Javascript with template literals it's now easier and more efficient to do so.</p>
<h2 id="building-template-literals">Building Template Literals</h2>
<p>To build a Template Literal use the backtick (&lt;code&gt;`&lt;/code&gt;) character to open and close the string. In essence it's not different than concatenating strings but it allows you to create the string literals without worrying about whether you interpolated the correct type of quotation mark (&lt;code&gt;'&lt;/code&gt; and &lt;code&gt;&quot;&lt;/code&gt;) or the &lt;code&gt;+&lt;/code&gt; sign when creating multi-line strings.</p>
<p>At it's simplest, an ES6 Template String Literal is written like this:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> demoString <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello World.</span><span class="token template-punctuation string">`</span></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>demoString<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We can also create Template Literal Strings using the same system. Also note how we've been able to add amgle brackets to open and close tags and single quotation marks to the longer example.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> longerString <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The second, greyed out example shown here shows the faux subscripts the browser creates by scaling whatever you put in the H&lt;sub> tag; by using the sinf class from Utility OpenType instead, you’ll use the optically correct glyphs included in your web font. In browsers that don’t support the OpenType features, the browser default will still be used.</span><span class="token template-punctuation string">`</span></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>longerString<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="variable-interpolation">Variable interpolation</h3>
<p>Where the Template String Literals really show their strengths is when we interpolate variables in the longer string. Going back to our first example we'll add a variable to show the name of the person we're greeting:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> userName2 <span class="token operator">=</span> <span class="token string">"carlos"</span>
<span class="token keyword">var</span> greeting <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userName2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Returns Hello, carlos!</span>
</code></pre>
<p>In this example, the interpolation is the <code>${userName}</code> string that will take the value of the corresponding variable and put it's name in place holder.</p>
<p>We can also work with arrays as the source of interpolation data, something like the example below where we interpolate the valies in the <code>userData</code> array:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> userData <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"Carlos"</span><span class="token punctuation">,</span>
  <span class="token string">"home"</span><span class="token operator">:</span> <span class="token string">"Chile"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> greeting2 <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userData<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!.

The weather in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userData<span class="token punctuation">.</span>home<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Using that last bit of code we can visit an interesting idea. Using String Template Literals when doing Translation.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> userData <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">"en"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"chapter"</span><span class="token operator">:</span> <span class="token string">"Chapter"</span><span class="token punctuation">,</span>
    <span class="token string">"section"</span><span class="token operator">:</span> <span class="token string">"Section"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"es"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"chapter"</span><span class="token operator">:</span> <span class="token string">"Capítulo"</span><span class="token punctuation">,</span>
    <span class="token string">"section"</span><span class="token operator">:</span> <span class="token string">"Sección"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> chapterHeading <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userData<span class="token punctuation">.</span>en<span class="token punctuation">.</span>chapter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 1, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userData<span class="token punctuation">.</span>en<span class="token punctuation">.</span>section<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 1.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chapterHeading<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Produces: Chapter 1, Section 1.</span>

<span class="token keyword">var</span> chapterHeadingEs <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userData<span class="token punctuation">.</span>es<span class="token punctuation">.</span>chapter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 1, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userData<span class="token punctuation">.</span>es<span class="token punctuation">.</span>section<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 1.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chapterHeadingEs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Produces: Capítulo 1, Sección 1.</span>
</code></pre>
<p>Using the code above we can also insert it in our HTML, looking something like this:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>`${chapterHeading}` (English)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>`${chapterHeadingEs}` (Spanish)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
</code></pre>
<p>The challenge is to dynamically set the current language and use the corresponding entry from the language database.  I did a naive pass before finding an external solution that work better.</p>
<h2 id="a-more-complete-example">A more complete example</h2>
<p>It's tempting to try and reinvent the wheel (and fail miseable luke I did) it's good to go around and see what's out there.</p>
<p>Andrea Giamarchi's <a href="https://codeburst.io/easy-i18n-in-10-lines-of-javascript-poc-eb9e5444d71e">Easy i18n in 10 lines of JavaScript (PoC)</a> provides a more robust idea for how to do translation using template literals. This code has been further developed in a <a href="https://github.com/WebReflection/i18n-utils">Github Repo</a>. I will stay with the original idea of the post, and leave it to you if you want to use the llibrary.</p>
<p>The first part of this process is to define how we'll handle the i18n templates. This will query the database and, based on the language key, we return the string for the matched language.</p>
<p>It will also set up the default language (<code>en</code>) and an empty internationalization database (<code>i18n.db</code>).</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">i18n</span><span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span>
    info <span class="token operator">=</span> i18n<span class="token punctuation">.</span>db<span class="token punctuation">[</span>i18n<span class="token punctuation">.</span>locale<span class="token punctuation">]</span><span class="token punctuation">[</span>template<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\x01'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    out <span class="token operator">=</span> <span class="token punctuation">[</span>info<span class="token punctuation">.</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> length <span class="token operator">=</span> info<span class="token punctuation">.</span>t<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span>
  <span class="token punctuation">)</span> out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">+</span> info<span class="token punctuation">.</span>v<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> info<span class="token punctuation">.</span>t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
i18n<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token string">'en'</span><span class="token punctuation">;</span>
i18n<span class="token punctuation">.</span>db <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>The next function creates the database for the translation. We'll use this to populate the database that we'll feed translations to.</p>
<pre class="language-javascript"><code class="language-javascript">i18n<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token parameter">locale</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">tCurrent<span class="token punctuation">,</span> <span class="token operator">...</span>rCurrent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> tCurrent<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\x01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> db <span class="token operator">=</span> i18n<span class="token punctuation">.</span>db<span class="token punctuation">[</span>locale<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>i18n<span class="token punctuation">.</span>db<span class="token punctuation">[</span>locale<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    t<span class="token operator">:</span> tCurrent<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    v<span class="token operator">:</span> rCurrent<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">for</span><span class="token operator">:</span> <span class="token parameter">other</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">tOther<span class="token punctuation">,</span> <span class="token operator">...</span>rOther</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      db <span class="token operator">=</span> i18n<span class="token punctuation">.</span>db<span class="token punctuation">[</span>other<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>i18n<span class="token punctuation">.</span>db<span class="token punctuation">[</span>other<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      db<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        t<span class="token operator">:</span> tOther<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        v<span class="token operator">:</span> rOther<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> rCurrent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Andrea provides multiple ways to populate the database. For this example I will populate it using the <code>set</code> method. The example below set a groiup of entries using English as the default language and then using <code>.for</code> to identify additional languages and their translation.</p>
<pre class="language-javascript"><code class="language-javascript">i18n<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'name'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'de'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hallo </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'name'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'it'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Ciao </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'name'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'sp'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hola </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'name'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre>
<p>TO create a database containing translation information for our books could look like this:</p>
<pre class="language-javascript"><code class="language-javascript">i18n<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Chapter </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'number'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'es'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Capítulo </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'number'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'de'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Kapitel </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'number'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Chapitre </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'number'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre>
<p>We can then use the default language and type the data in English.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// default</span>
i18n<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Chapter </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'73'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// "Chapter 73"</span>
</code></pre>
<p>We also have the option of switching languages at run time, continue writing our text in English and see it translated using the database content.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// we switch to German but still write in English</span>
i18n<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token string">'de'</span><span class="token punctuation">;</span>
i18n<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Chapter </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'73'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// "Kapitel 73"</span>

i18n<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token string">'es'</span><span class="token punctuation">;</span>
i18n<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Chapter </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'73'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// Capítulo 73</span>
</code></pre>
<p>This code presents a basic engine that will cover most of our needs, if we're willing to do the data entry ourselves or use the libraries and utilities Andreas present in Github.</p>
<p>This project is not meant to replace libraries like <a href="https://github.com/globalizejs/globalize">Globalize</a>, <a href="http://site.icu-project.org/">ICU</a>,<a href="http://cldr.unicode.org/"> Unicode CLDR</a>.</p>
