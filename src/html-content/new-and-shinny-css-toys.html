<h1 id="new-and-shinny-css-toys" tabindex="-1">New and shinny CSS toys</h1>
<h2 id="css-layers" tabindex="-1">CSS Layers</h2>
<p>CSS layers resolve another problem with CSS specificity and rule order.</p>
<p>as I documented in: <a href="https://publishing-project.rivendellweb.net/looking-forward-css-layers-and-the-layer-at-rule/">Looking forward: CSS Layers and the @layer at-rule</a> CSS Layers or Cascade Layers are a way to group styles together and then apply them in a specific order.</p>
<p>All modern browsers now support cascade layers.</p>
<p>The idea behind layers is that you create layers as groups so that all the styles in a layer have the same priority and cascade together.</p>
<p>There are three ways to create layers:</p>
<ol>
<li>
<p>Using the @layer block at-rule, with styles assigned immediately to it:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@layer</span> base</span> <span class="token punctuation">{</span>
  &amp;hellip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li>
<p>Using the @layer statement at-rule, without any styles assigned:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@layer</span> base<span class="token punctuation">;</span></span>
</code></pre>
<p>With this system we can also define multiple layers and append content to each later.</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@layer</span>
  normalize<span class="token punctuation">,</span>
  base<span class="token punctuation">,</span>
  theme<span class="token punctuation">,</span>
  content<span class="token punctuation">;</span></span>
</code></pre>
</li>
<li>
<p>Using @import with the layer keyword or layer() function:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>base.css<span class="token punctuation">)</span></span> <span class="token function">layer</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
</code></pre>
</li>
</ol>
<p>For simplicity’s sake we’ll use the firt method in the rest of this post.</p>
<p>The following stylesheet will create five layers for different groups of CSS. Rules in each group will cascade together and share the same priority within the author styles.</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@layer</span> normalize</span> <span class="token punctuation">{</span> &amp;hellip<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@layer</span> base</span> <span class="token punctuation">{</span> &amp;hellip<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@layer</span> theme</span> <span class="token punctuation">{</span> &amp;hellip<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@layer</span> content</span> <span class="token punctuation">{</span> &amp;hellip<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre>
<p>Declarations in the layers defined later in the document will will against declarations in earlier layers. The specificity of the rules inside the layers is not as important as the order in which we declare the layers.</p>
<p>If there are declarations in the <code>theme</code> layer that match declarations in either base or normalize then theme will win since it’s declared later in the document but it won’t win against declarations in the <code>content</code> layer since content is declared later in the document.</p>
<p>As Bramus points out in <a href="https://www.bram.us/2021/09/15/the-future-of-css-cascade-layers-css-at-layer/">his article about layers</a>:</p>
<blockquote>
<p>Once a winning declaration has been determined via Layer Order, the Cascade won’t even check Specificity or Order of Appearance for those declarations anymore. This is because Layers is a separate and higher ranked criterion of the Cascade.</p>
</blockquote>
<p>When building a new project, this is the way to go, but the question I have is this: How do we make sure that content in layers works well with existing content that is not in layers?</p>
<p>If I understand it correctly content outside layers will be read last, overriding content in all layers.</p>
<h3 id="more-information" tabindex="-1">More information</h3>
<ul>
<li><a href="https://www.w3.org/TR/css-cascade-5/#layering">CSS Cascade 5 specification</a></li>
<li><a href="https://css.oddbird.net/layers/explainer/">Cascade layers explainer</a></li>
<li><a href="https://developer.mozilla.org/docs/Web/CSS/@layer">Cascade layers</a> — MDN</li>
<li><a href="https://developer.chrome.com/blog/cascade-layers/">Cascade Layers</a> — Una Kravets</li>
<li><a href="https://ishadeed.com/article/cascade-layers/">Hello, CSS Cascade Layers</a> — Ahmad Shadeed</li>
</ul>
<h2 id="new-ways-to-write-media-queries" tabindex="-1">New ways to write media queries</h2>
<p>In the past we’ve had to write media queries that check for screen/device width as something like this.</p>
<p>This query checks if the screen has a minimum width of 768px</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  &amp;hellip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>and this query checks is the screen is smaller than 768px</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  &amp;hellip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can also combine tests to determine if the value you’re testing is within two values.</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> 
  <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">)</span>
  <span class="token keyword">and</span>
  <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 1024px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  &amp;hellip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The new <a href="https://www.w3.org/TR/mediaqueries-4/#mq-range-context">Media Queries spec</a> explains new syntax for media queries using ranges.</p>
<p>We can write the media queries using smaller or equal than. The new syntax for the query looks like this:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span>width &lt;= 768px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  &amp;hellip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The larger than query can use the larger or equal than:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span>width >= 768px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  &amp;hellip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And the combined query can be rewriten like this. Width can be larger or equal to 800px and equal or smaller than 1024px.</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span>800px &lt;=width &lt;= 1024px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  &amp;hellip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The new syntax makes it cleaner and, to me, makes the meaning of the query clearer than it would be in the old syntax.</p>
<h3 id="notes-and-links" tabindex="-1">Notes and links</h3>
<ul>
<li><a href="https://www.w3.org/TR/mediaqueries-5/#mq-range-context">Media query ranges specification</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries#syntax_improvements_in_level_4">Media query range syntax</a> — MDN</li>
<li><a href="https://developer.chrome.com/blog/media-query-range-syntax/">New syntax for range media queries in Chrome 104</a> — Chrome Developer blog</li>
<li><a href="https://github.com/postcss/postcss-media-minmax">PostCSS plugin</a></li>
</ul>
<h2 id="%40media-(prefers-reduced-data)" tabindex="-1">@media (prefers-reduced-data)</h2>
<p>The <code>prefers-reduced-data</code> media query detects if the user has requested the web content that consumes less internet traffic via the browser or operating system’s <code>data-saver</code> option.</p>
<p>Until the introduction of the <code>prefers-reduced-data</code> media query, there was no way to honor the <code>data-saver</code> settings.</p>
<p>In a music shop app or in any other application where we have a lot of images represeting products, we can ask the browser to remove the images if the user has requested to save data using something like this:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-reduced-data</span><span class="token punctuation">:</span> reduce<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">.album-cover</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This will reduce the number of requests and will improve loading speed and overall performance of your site.</p>
<h3 id="notes-and-links-1" tabindex="-1">Notes and links</h3>
<ul>
<li><a href="https://www.w3.org/TR/mediaqueries-5/#prefers-reduced-data">prefers-reduced-data mediaquery</a> spec</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-data">prefers-reduced-data</a> — MDN</li>
<li><a href="https://www.smashingmagazine.com/2021/12/core-web-vitals-case-study-smashing-magazine/#savedata-and-prefers-reduced-data">SaveData And prefers-reduced-data</a> — Smashing Magazine</li>
<li>Example: <a href="https://web.dev/building-a-media-scroller-component/">Media Scroller component</a></li>
</ul>
<h2 id="%40custom-media" tabindex="-1">@custom-media</h2>
<p>Of all the new features the one I’ve been researching is <code>@custom-media</code>.</p>
<p>Custom media queries allow you to create, in esence, create variables in CSS where we associate a name with a media query and can reuse it throughout the stylesheet.</p>
<p>This is useful as it gives authors a single place to make changes and prevents errors due to typos and not updating a media query exactly the same way everywhere it is used.</p>
<p>Naming things is also important. As Adam Argyle points out in <a href="https://web.dev/state-of-css-2022/#no-media-query-variables">No media query variables</a>:</p>
<blockquote>
<p>Naming things is very important: it can align purpose with the syntax, making things easier to share and easier to use in teams.</p>
</blockquote>
<p>In the following example, we define a narrow window media query using the <code>@custom-media</code> at-rule and a syntax using two dashes <code>--</code> as the starting chracters in the name. In this example, we also use media query ranges in the definition.</p>
<p>When we call the custom media query we only need to reference it by name, not the full media query. We can do this as many times as it is necessary.</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@custom-media</span> --narrow-window <span class="token punctuation">(</span> width &lt;= 30em<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span>--narrow-window<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token comment">/* narrow window styles */</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the same article, Adam provides examples of custom media queries from his <a href="https://open-props.style/">Open Props</a> project.</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* Viewport Variables */</span>
<span class="token atrule"><span class="token rule">@custom-media</span> --portrait      <span class="token punctuation">(</span><span class="token property">orientation</span><span class="token punctuation">:</span> portrait<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --landscape     <span class="token punctuation">(</span><span class="token property">orientation</span><span class="token punctuation">:</span> landscape<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token atrule"><span class="token rule">@custom-media</span> --md-only       <span class="token punctuation">(</span>480px &lt;= width &lt;= 768px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --md-n-above    <span class="token punctuation">(</span>width >= 768px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --md-n-below    <span class="token punctuation">(</span>width &lt;= 768px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --md-phone      <span class="token punctuation">(</span>--md-only<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>--portrait<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token atrule"><span class="token rule">@custom-media</span> --xxl-only      <span class="token punctuation">(</span>1440px &lt;= width &lt;= 1920px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --xxl-n-above   <span class="token punctuation">(</span>width >= 1920px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --xxl-n-below   <span class="token punctuation">(</span>width &lt;= 1920px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token comment">/* Capability Variables */</span>
<span class="token atrule"><span class="token rule">@custom-media</span> --touch    <span class="token punctuation">(</span><span class="token property">hover</span><span class="token punctuation">:</span> none<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">pointer</span><span class="token punctuation">:</span> coarse<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --stylus   <span class="token punctuation">(</span><span class="token property">hover</span><span class="token punctuation">:</span> none<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">pointer</span><span class="token punctuation">:</span> fine<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --pointer  <span class="token punctuation">(</span>hover<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">pointer</span><span class="token punctuation">:</span> coarse<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --mouse    <span class="token punctuation">(</span>hover<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">pointer</span><span class="token punctuation">:</span> fine<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token atrule"><span class="token rule">@custom-media</span> --HDcolor  <span class="token punctuation">(</span><span class="token property">dynamic-range</span><span class="token punctuation">:</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token comment">/* Preference Variables */</span>
<span class="token atrule"><span class="token rule">@custom-media</span> --highContrast  <span class="token punctuation">(</span><span class="token property">prefers-contrast</span><span class="token punctuation">:</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --lowContrast   <span class="token punctuation">(</span><span class="token property">prefers-contrast</span><span class="token punctuation">:</span> low<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token atrule"><span class="token rule">@custom-media</span> --opacityOK     <span class="token punctuation">(</span><span class="token property">prefers-reduced-transparency</span><span class="token punctuation">:</span> no-preference<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --opacityNotOK  <span class="token punctuation">(</span><span class="token property">prefers-reduced-transparency</span><span class="token punctuation">:</span> reduce<span class="token punctuation">)</span><span class="token punctuation">;</span></span>

<span class="token atrule"><span class="token rule">@custom-media</span> --useDataOK     <span class="token punctuation">(</span><span class="token property">prefers-reduced-data</span><span class="token punctuation">:</span> no-preference<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@custom-media</span> --useDataNotOK  <span class="token punctuation">(</span><span class="token property">prefers-reduced-data</span><span class="token punctuation">:</span> reduce<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
</code></pre>
<h3 id="links-and-resources" tabindex="-1">Links and Resources</h3>
<ul>
<li><a href="https://www.w3.org/TR/mediaqueries-5/#custom-mq">Custom Media Queries specification</a></li>
<li><a href="https://github.com/postcss/postcss-custom-media">Custom media queries PostCSS plugin</a></li>
<li><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1234172">Chromium Issue</a> — star the issue to improve odds of development</li>
</ul>
<h2 id="defining-custom-properties-from-javascript" tabindex="-1">Defining custom properties from Javascript</h2>
<p>When I was writing a previous post, I wanted to create custom properties in Javascript that I could use in CSS based on the result of running <a href="https://colorjs.io/">color.js</a> to convert colors and then test if the browser supports a given colorspace.</p>
<p>This example, as posted in <a href="https://publishing-project.rivendellweb.net/using-color-js-as-a-bridge-between-color-spaces/">Using color.js as a bridge between color spaces</a>, takes a color defined as a new color.js <code>Color</code> object, converts it to an sRGB string as a default.</p>
<p>The script then tests if the browser supports different color spaces (LCH and Display-P3) using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CSS/supports">css.supports()</a> method. If the color space is supported then it converts the color to a string in the specified color space</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Color <span class="token keyword">from</span> <span class="token string">"colorjs.io"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token string">"#663399"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Initialize cssColor</span>
<span class="token keyword">let</span> cssColor<span class="token punctuation">;</span>

cssColor <span class="token operator">=</span> rp<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">"srgb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">"p3"</span><span class="token punctuation">,</span> cssColor<span class="token punctuation">)</span><span class="token punctuation">)</span>
  cssColor <span class="token operator">=</span> rp<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">"p3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">"lch"</span><span class="token punctuation">,</span> cssColor<span class="token punctuation">)</span><span class="token punctuation">)</span>
  cssColor <span class="token operator">=</span> rp<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">"lch"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cssColor<span class="token punctuation">;</span> 
</code></pre>
<p>We can then use the value of CSS color as the value of a custom property.</p>
<p>Assuming the following code is part of the same script, we can write code like this:</p>
<pre class="language-css"><code class="language-css"><span class="token selector">if (!window.CSS.registerProperty)</span> <span class="token punctuation">{</span>
  console.<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Houdini porperties not supported'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token selector">CSS.registerProperty(</span><span class="token punctuation">{</span>
  <span class="token selector">name: "--color-name",
  syntax: "&lt;color>",
  initialValue: `$</span><span class="token punctuation">{</span>cssColor<span class="token punctuation">}</span>`<span class="token punctuation">,</span>
  <span class="token property">inherits</span><span class="token punctuation">:</span> false
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token selector">else</span> <span class="token punctuation">{</span>
  <span class="token selector">document.documentElement.style.setProperty('--color-name', `$</span><span class="token punctuation">{</span>cssColor<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="toggle()" tabindex="-1">toggle()</h2>
<h2 id="scroll-start" tabindex="-1">scroll-start</h2>
<h2 id="inert" tabindex="-1">inert</h2>
<h2 id="subgrid" tabindex="-1">Subgrid</h2>
<h2 id="container-queries" tabindex="-1">Container-queries</h2>
<h2 id="color-fonts-v1" tabindex="-1">Color fonts v1</h2>
<h2 id="viewport-unit-variants" tabindex="-1">Viewport unit variants</h2>
<h2 id="%3Ahas()" tabindex="-1">:has()</h2>
