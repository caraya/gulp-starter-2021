<html lang="en" dir="ltr" class="no-js lazy">

<head>
  <!--<link rel="stylesheet" href="ccs/github.css">-->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/image-load.css">
  <link rel="stylesheet" href="css/video-load.css">
  <link rel="stylesheet" href="css/prism.css">
  <!-- <script async src="scripts/menu.js"></script> -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <title></title>
</head>

<body>
<article class="container">
  <h1 id="computer-speech">Computer Speech</h1>
<p>Accidentally I discovered a new API that makes it easier to interact with your site/app using your voice. The <a href="https://dvcs.w3.org/hg/speech-api/raw-file/tip/speechapi.html">Speech Synthesis API</a> provide both ends of the computer conversation, the recognition to listen and the synthesis to speak.</p>
<p>Right now I'm more interested in the synthesis part and how we can include it as additional feedback on our sites and applications as an additional cue for user interaction.</p>
<h2 id="synthesis">Synthesis</h2>
<p>The Speech Syntthesis API gives us a way to &quot;speak&quot; strings of text without having to record them. These 'utterances' (in API speak) can be further customized.</p>
<p>At the most basic the utterance is made of the following:</p>
<ul>
<li>An instance of <code>SpeechSynthesisUtterance</code></li>
<li>The text and language we want the voice spoken in</li>
<li>The instruction to actually speak the command using <code>speechSynthesis.speak</code></li>
</ul>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> msg1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechSynthesisUtterance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
msg1<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"I'm sorry, Dave, I can't do that"</span><span class="token punctuation">;</span>
msg1<span class="token punctuation">.</span>lang <span class="token operator">=</span> <span class="token string">'en-US'</span><span class="token punctuation">;</span>

speechSynthesis<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The example below changes the content and the language to <code>es-cl</code> (Spanish as spoken in Chile). The structure of the code is the same.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> msg2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechSynthesisUtterance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
msg2<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"Dicen que el tiempo guarda en las bastillas"</span><span class="token punctuation">;</span>
msg2<span class="token punctuation">.</span>lang <span class="token operator">=</span> <span class="token string">'es-cl'</span><span class="token punctuation">;</span>

speechSynthesis<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Copy and past each example in your Dev Tools (I use Chrome's and have tested in Chrome and Firefox) and notice how different the default voices are for each message and for each browser you test with.</p>
<p>We can further customize the utterance with additional parameters. The parameters are now</p>
<ul>
<li><code>msg</code> contains a new instance of <code>SpeechSynthesisUtterance</code></li>
<li><code>voices</code> contains an array of all the voices available to the user agent (browser in this case)</li>
<li><code>voice</code> assigns a voice from the voices array to the instance of utterance we are working with</li>
<li><code>voiceURI</code>  specifies speech synthesis voice and the location of the speech synthesis service that the web application wishes to use</li>
<li><code>rate</code> indicates how fast the text is spoken. 1 is the default rate supported by the speech synthesis engine or specific voice (which should correspond to a normal speaking rate). 2 is twice as fast, and 0.5 is half as fast</li>
<li><code>pitch</code> specifies the speaking pitch for the utterance. It ranges between 0 and 2 inclusive, with 0 being the lowest pitch and 2 the highest pitch. 1 corresponds to the default pitch of the speech synthesis engine or specific voice</li>
</ul>
<p>As before <code>text</code> holds the message we want the browser to speak, <code>lang</code> holds the language we want the browser to speak in and the <code>speechSynthesis.speak</code> command will actually make the browser speak our phrase.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechSynthesisUtterance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> voices <span class="token operator">=</span> window<span class="token punctuation">.</span>speechSynthesis<span class="token punctuation">.</span><span class="token function">getVoices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Note: some voices don't support altering params</span>
msg<span class="token punctuation">.</span>voice <span class="token operator">=</span> voices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
msg<span class="token punctuation">.</span>voiceURI <span class="token operator">=</span> <span class="token string">'native'</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>volume <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 0 to 1</span>
msg<span class="token punctuation">.</span>rate <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 0.1 to 10</span>
msg<span class="token punctuation">.</span>pitch <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">//0 to 2</span>
msg<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>lang <span class="token operator">=</span> <span class="token string">'en-US'</span><span class="token punctuation">;</span>

speechSynthesis<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="putting-speech-synthesis-into-action%3A-why-and-where-would-we-use-this%3F">Putting speech synthesis into action: why and where would we use this?</h2>
<p>The most obvious place for me to use speech synthesis is as additional cues and messages to end-users when there is an error and problem. We'll define three different functions to encapsulate the errors messages we want to &quot;talk&quot; to the user about.</p>
<p>For this example we'll use the following HTML code:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span>Basic User Information<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User Name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
</code></pre>
<p>For the sake of the demo I'm only interested in the input fields and not in having a fully functional working form.</p>
<p>I will break the Javascript portion of the demo in two parts. The first part defines the Speech Recognition portion of the script which is very similar to the examples we've already discussed.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Setup the Username Empty Error function</span>
<span class="token keyword">function</span> <span class="token function">speakUsernameEmptyError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> msg1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechSynthesisUtterance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  msg1<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"The Username field can not be empty"</span><span class="token punctuation">;</span>
  msg1<span class="token punctuation">.</span>lang <span class="token operator">=</span> <span class="token string">'en-US'</span><span class="token punctuation">;</span>

  speechSynthesis<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Setup the Password Empty Error function</span>
<span class="token keyword">function</span> <span class="token function">speakPasswordEmptyError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> msg2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechSynthesisUtterance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  msg2<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"The Password field can not be empty"</span><span class="token punctuation">;</span>
  msg2<span class="token punctuation">.</span>lang <span class="token operator">=</span> <span class="token string">'en-US'</span><span class="token punctuation">;</span>

  speechSynthesis<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The second part of the script assigns <code>blur</code> event listeners to the input elements. Inside each event handler the code checks if the field is empty. If it is the code adds a 1px red border around it and plays the appropriate utterance we crafted earlier. If the field is not empty, either because the user entered a value before moving out of the field or at a later time, we set the border to a 1-pixel solid black color.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Assign variables to hold the elements</span>
<span class="token keyword">let</span> username <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> password <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add blur event listener to the username field</span>
username<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// If the field is empty</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Put a 1 pixel red border on the input field</span>
    username<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'1px solid red'</span><span class="token punctuation">;</span>
    <span class="token comment">// Speak the error as specified in the</span>
    <span class="token comment">// speakUsernameEmptyError function</span>
    <span class="token function">speakUsernameEmptyError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'1px solid black'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add blur event listener to the password field</span>
password<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// If the field is empty</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Put a 1 pixel red border on the input field</span>
    password<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'1px solid red'</span><span class="token punctuation">;</span>
    <span class="token comment">// Speak the error as specified in the</span>
    <span class="token comment">// speakPasswordEmptyError function</span>
    <span class="token function">speakPasswordEmptyError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    password<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'1px solid black'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>The functions and event listeners are very basic and could stand some additional work, particularly in the validation area.</p>
<h2 id="sources">Sources</h2>
<ul>
<li><a href="https://developers.google.com/web/updates/2014/01/Web-apps-that-talk-Introduction-to-the-Speech-Synthesis-API">Web apps that talk - Introduction to the Speech Synthesis API</a></li>
<li><a href="https://www.sitepoint.com/talking-web-pages-and-the-speech-synthesis-api/">Talking Web Pages and the Speech Synthesis API</a></li>
</ul>
<h2 id="recognition">Recognition</h2>
<p>&lt;div class=&quot;message warning&quot;&gt;
&lt;p&gt;&lt;strong&gt;Speech Recognition only works in Chrome and Opera. Firefox says it supports it but it doesn't work and returns a very criptic error message.&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;</p>
<p>The second part of the Speech Synthesis API is recognition. Where in the prior post we used the Speech Synthesis API to have the browser talk to use when there was a problem on the form; in this post we'll use a [demo from Mozilla](demo from Mozilla) to illustrate a potential use of speech recognition to make the browser change the background color of the page based on what the user speaks in to a microphone.</p>
<p>Because we're using the user's microphone the page/application must explicitly ask for permission and it must be granted before any of this code will work.  This permission can be revoked at any time.</p>
<p>The HTML is simple. A place holder paragraph to hold any hints we provide the user and another paragraph to hold the output of the processes.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Speech color changer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hints<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>output<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">></span></span>...diagnostic messages<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>The first portion of the scrpt creates a <a href="https://www.w3.org/TR/jsgf/">JSGF Grammar</a> for the elements we want to recognize. JSGF is an old Sun Microsystems <a href="https://www.w3.org/TR/jsgf/">W3C submission</a> that was used as the basis for the W3C Voice Browser Working Group (closed on October, 2015).</p>
<p>This will create the vocabulary that the rest of the script will recognize.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'aqua'</span> <span class="token punctuation">,</span> <span class="token string">'azure'</span> <span class="token punctuation">,</span> <span class="token string">'beige'</span><span class="token punctuation">,</span> <span class="token string">'bisque'</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'brown'</span><span class="token punctuation">,</span> 
<span class="token string">'chocolate'</span><span class="token punctuation">,</span> <span class="token string">'coral'</span><span class="token punctuation">,</span> <span class="token string">'crimson'</span><span class="token punctuation">,</span> <span class="token string">'cyan'</span><span class="token punctuation">,</span> <span class="token string">'fuchsia'</span><span class="token punctuation">,</span> <span class="token string">'ghostwhite'</span><span class="token punctuation">,</span> <span class="token string">'gold'</span><span class="token punctuation">,</span> 
<span class="token string">'goldenrod'</span><span class="token punctuation">,</span> <span class="token string">'gray'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'indigo'</span><span class="token punctuation">,</span> <span class="token string">'ivory'</span><span class="token punctuation">,</span> <span class="token string">'khaki'</span><span class="token punctuation">,</span> <span class="token string">'lavender'</span><span class="token punctuation">,</span> <span class="token string">'lime'</span><span class="token punctuation">,</span> 
<span class="token string">'linen'</span><span class="token punctuation">,</span> <span class="token string">'magenta'</span><span class="token punctuation">,</span> <span class="token string">'maroon'</span><span class="token punctuation">,</span> <span class="token string">'moccasin'</span><span class="token punctuation">,</span> <span class="token string">'navy'</span><span class="token punctuation">,</span> <span class="token string">'olive'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token string">'orchid'</span><span class="token punctuation">,</span>
<span class="token string">'peru'</span><span class="token punctuation">,</span> <span class="token string">'pink'</span><span class="token punctuation">,</span> <span class="token string">'plum'</span><span class="token punctuation">,</span> <span class="token string">'purple'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'salmon'</span><span class="token punctuation">,</span> <span class="token string">'sienna'</span><span class="token punctuation">,</span> <span class="token string">'silver'</span><span class="token punctuation">,</span> <span class="token string">'snow'</span><span class="token punctuation">,</span>
<span class="token string">'tan'</span><span class="token punctuation">,</span> <span class="token string">'teal'</span><span class="token punctuation">,</span> <span class="token string">'thistle'</span><span class="token punctuation">,</span> <span class="token string">'tomato'</span><span class="token punctuation">,</span> <span class="token string">'turquoise'</span><span class="token punctuation">,</span> <span class="token string">'violet'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> grammar <span class="token operator">=</span> <span class="token string">'#JSGF V1.0; grammar colors; public &lt;color> = '</span> <span class="token operator">+</span> colors<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' | '</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' ;'</span>
<span class="token comment">// You can optionally log the grammar to console to see what it looks like</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'grammar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We next setup the speech recognition engine. The three variables: <code>SpeechRecognition</code>, <code>SpeechGrammarList</code> and <code>SpeechRecognitionEvent</code> have two possible values, either an unprefixed version (not supported anywhere) or the webkit prefixed version (supported by Chrome and Opera). It's always a good idea to future proof your code; I suspect that when Firefox finally supports the API it will be unprefixed.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> SpeechRecognition <span class="token operator">=</span> SpeechRecognition <span class="token operator">||</span> webkitSpeechRecognition<span class="token punctuation">;</span>
<span class="token keyword">var</span> SpeechGrammarList <span class="token operator">=</span> SpeechGrammarList <span class="token operator">||</span> webkitSpeechGrammarList<span class="token punctuation">;</span>
<span class="token keyword">var</span> SpeechRecognitionEvent <span class="token operator">=</span> SpeechRecognitionEvent <span class="token operator">||</span> webkitSpeechRecognitionEvent<span class="token punctuation">;</span>
</code></pre>
<p>The script then does assignments. First it associates variables with the speech recognition engine we set up above. Next the script configures the engine with the grammar created earlier and the attributes for the recognition engine to work.  It also create placeholders for the HTML elements that will hold messages to the user and will actually change the background color.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> recognition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechRecognition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> speechRecognitionList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechGrammarList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
speechRecognitionList<span class="token punctuation">.</span><span class="token function">addFromString</span><span class="token punctuation">(</span>grammar<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
recognition<span class="token punctuation">.</span>grammars <span class="token operator">=</span> speechRecognitionList<span class="token punctuation">;</span>
<span class="token comment">//recognition.continuous = false;</span>
recognition<span class="token punctuation">.</span>lang <span class="token operator">=</span> <span class="token string">'en-US'</span><span class="token punctuation">;</span>
recognition<span class="token punctuation">.</span>interimResults <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
recognition<span class="token punctuation">.</span>maxAlternatives <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> diagnostic <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hints <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.hints'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>For each color that we make available to the user, we use the color as the <code>background-color </code> to give the user an additional cue regarding the colors he can choose from.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> colorHTML<span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
colors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    colorHTML <span class="token operator">+=</span> <span class="token string">'&lt;span style="background-color:'</span> <span class="token operator">+</span> v <span class="token operator">+</span> <span class="token string">';"> '</span> <span class="token operator">+</span> v <span class="token operator">+</span> <span class="token string">' &lt;/span>'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The script is almost ready to start. It adds a message to the <code>.hint</code> container and, when the user clicks anywhere on the page, it begins the recognition process.</p>
<pre class="language-javascript"><code class="language-javascript">hints<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Tap/click then say a color to change the background color of the app. Try '</span><span class="token operator">+</span> colorHTML <span class="token operator">+</span> <span class="token string">'.'</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    recognition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Ready to receive a color command.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>When the user speaks and the script gets a result the <code>SpeechRecognitionResultList</code> object contains <code>SpeechRecognitionResult</code> objects. It has a getter so it can be accessed like an array.</p>
<p>The <code>last</code> variable holds the <code>SpeechRecognitionResult</code> object at the last position.</p>
<p>Each <code>SpeechRecognitionResult</code> object contains <code>SpeechRecognitionAlternative</code> objects that contain individual results. The <code>last</code> element represents the latest result the script obtained and, using the array notation we get the <code>transcript</code> for first result ([0]) of the latest (<code>last</code>) response the client has stored.</p>
<p>The script will allso display the result it received (sometimes it's funny to see what the recognition engine thinks you said), change the background color to the specified color and provide a confidence level percentage, the higher the number the most likely the user will get a correct answer and the color will change.</p>
<pre class="language-javascript"><code class="language-javascript">recognition<span class="token punctuation">.</span><span class="token function-variable function">onresult</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> last <span class="token operator">=</span> event<span class="token punctuation">.</span>results<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> color <span class="token operator">=</span> event<span class="token punctuation">.</span>results<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transcript<span class="token punctuation">;</span>

    diagnostic<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Result received: '</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">'.'</span><span class="token punctuation">;</span>
    bg<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> color<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Confidence: '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>confidence<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>The final part of the script handles additional events. When the script detects the end of speech it stops the recognition. When there is no match it will notify the users in the diagnostic element. Finally, if there is an error, we also report it to the user.</p>
<pre class="language-javascript"><code class="language-javascript">recognition<span class="token punctuation">.</span><span class="token function-variable function">onspeechend</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    recognition<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

recognition<span class="token punctuation">.</span><span class="token function-variable function">onnomatch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    diagnostic<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">"I didn't recognise that color."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

recognition<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    diagnostic<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Error occurred in recognition: '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>error<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="full-recognition-example">Full recognition example</h2>
<p>&lt;div class=&quot;message warning&quot;&gt;
&lt;p&gt;&lt;strong&gt;Speech Recognition only works in Chrome and Opera. Firefox says it supports it but it doesn't work and returns a very criptic error message.&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;</p>
<p>There is another way to work with speech recognition: dictation. Rather than work through the <a href="https://caraya.github.io/speech-demos/continuous-recognition.html">example</a> that illustrates how we can use the recognition portion of the API to create a dictation application that you can then copy of email.</p>
<h2 id="code-demo">Code demo</h2>
<p>All the code for this posts is available on <a href="https://github.com/caraya/speech-demos">Github</a></p>
<ul>
<li>https://developers.google.com/web/updates/2013/01/Voice-Driven-Web-Apps-Introduction-to-the-Web-Speech-API</li>
</ul>

</article>
<!--
</div> -->
<script src="scripts/lazy-load.js"></script>
<script src="scripts/vendor/clipboard.min.js"></script>
<script src="scripts/vendor/prism.js"></script>
<script src="scripts/vendor/fontfaceobserver.js"></script>
<script src="scripts/load-fonts.js"></script>
<script src="scripts/lazy-load-video.js"></script>
</body>
</html>